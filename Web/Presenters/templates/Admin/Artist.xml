{extends "@layout.xml"}

{block title}
    {if $id > 0}Редактирование исполнителя #{$id}{else}Новый исполнитель{/if}
{/block}

{block heading}
    {if $id > 0}Редактирование исполнителя #{$id}{else}Новый исполнитель{/if}
{/block}

{block headingWrap}
    {if $id > 0}Редактирование исполнителя #{$id}{else}Новый исполнитель{/if}
{/block}

{block content}
    <div class="content_block" style="display:flex;gap:16px;flex-wrap:wrap;">
        <form method="post" action="/admin/artist{$id}" enctype="multipart/form-data" class="content_item" style="flex:1;min-width:280px;">
            <input type="hidden" name="act" value="save" />
            <input type="hidden" name="hash" value="{$csrfToken}" />
            <div class="form_row">
                <label>Имя</label>
                <input type="text" name="name" value="{$artist ? $artist->name : ''}" required />
            </div>
            <div class="form_row">
                <label>Описание</label>
                <textarea name="bio" rows="4">{$artist ? $artist->bio : ''}</textarea>
            </div>
            <div class="form_row">
                <label>ID фото (avatar_photo_id)</label>
                <input type="number" name="avatar_photo_id" value="{$artist && $artist->avatar_photo_id ? $artist->avatar_photo_id : ''}" />
            </div>
            <div class="form_row">
                <label>Загрузить аватар</label>
                <input type="file" name="avatar" accept="image/*" />
            </div>
            <div class="form_row" n:if="$artistAvatarUrl">
                <label>Текущий аватар</label>
                <span class="aui-avatar aui-avatar-project aui-avatar-large">
                    <span class="aui-avatar-inner">
                        <img src="{$artistAvatarUrl}" alt="avatar" style="object-fit:cover;" />
                    </span>
                </span>
            </div>
            <div class="form_row">
                <label>Загрузить аватар</label>
                <input type="file" name="avatar" accept="image/*" />
            </div>
            <div class="form_row">
                <button type="submit">Сохранить</button>
                {if $id > 0}<a class="button" href="/artist{$id}" target="_blank">Открыть публичную</a>{/if}
            </div>
        </form>

        {if $id > 0}
        <form method="post" action="/admin/artist{$id}" class="content_item" style="flex:1;min-width:280px;">
            <input type="hidden" name="act" value="attach_tracks" />
            <input type="hidden" name="hash" value="{$csrfToken}" />
            <div class="form_row">
                <label>ID треков (через запятую/пробел)</label>
                <textarea name="audio_ids" rows="4" placeholder="например: 123, 124 125"></textarea>
            </div>
            <div class="form_row">
                <button type="submit">Привязать треки</button>
            </div>
        </form>
        {/if}
    </div>
    <div n:if="$id > 0" class="content_block" style="margin-top:16px;">
        <h3>Привязанные треки</h3>
        <table class="aui aui-table-list">
            <thead>
                <tr>
                    <th style="width:80px;">ID</th>
                    <th>Исполнитель</th>
                    <th>Название</th>
                    <th style="width:160px;">Действия</th>
                </tr>
            </thead>
            <tbody>
                <tr n:if="sizeof($artistTracks) == 0">
                    <td colspan="4" style="opacity:.7;">Нет треков</td>
                </tr>
                <tr n:foreach="$artistTracks as $audio">
                    <td>{$audio->getId()}</td>
                    <td>{$audio->getPerformer()}</td>
                    <td>{$audio->getTitle()}</td>
                    <td>
                        <a class="button" href="/audio{$audio->getId()}_{$audio->getOwner()->getId()}" target="_blank">Открыть</a>
                        <a class="button" href="/admin/music/{$audio->getId()}/edit">Редактировать</a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
{/block}

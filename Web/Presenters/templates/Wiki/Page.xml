{extends "../@layout.xml"}
{block title}{$title} — {$club->getName()}{/block}
{block header}{/block}
{block content}
  <div class="clear_fix">
    <div class="left_big_block">
      <div class="page_block">
        <div class="page_block_header clear_fix">
          <div class="page_block_header_inner _header">
            <div class="tabs">
              <div class="tab">
                <a href="{$club->getURL()}/wiki">Страницы</a>
              </div>
              <div id="activetabs" class="tab">
                <a href="{$club->getURL()}/wiki/{$slug}">Просмотр</a>
              </div>
              <div class="tab">
                <a href="{$club->getURL()}/wiki/help">Помощь по разметке</a>
              </div>
              <div class="tab" n:if="$canModify" style="float:right;">
                <a href="{$club->getURL()}/wiki/{$slug}/edit">Редактировать</a>
              </div>
              <div class="tab" style="float:right;">
                <a href="{$club->getURL()}">К сообществу</a>
              </div>
            </div>
          </div>
        </div>
        <div class="page_block_content">
          <div id="wiki_toc" class="msg" style="display:none; padding:10px 12px;">
            <b>Оглавление</b>
            <ul id="wiki_toc_list" class="list_docs" style="margin-top:6px;"></ul>
          </div>
        </div>
        <div class="page_block_content wiki_content">
          {if $html}
            {$html|noescape}
          {else}
            <div class="msg msg_info">Страница пустая.</div>
          {/if}
        </div>
      </div>
    </div>
  </div>
{/block}
{* modal editor removed in favor of direct /edit link *}
<script>
  (function(){
    var content = document.querySelector('.wiki_content');
    if(!content) return;

    // Build TOC from headings
    var hs = content.querySelectorAll('h2, h3');
    if(hs.length){
      var toc = document.getElementById('wiki_toc');
      var list = document.getElementById('wiki_toc_list');
      hs.forEach(function(h){
        var id = h.getAttribute('id');
        if(!id){
          id = (h.textContent||'h').toLowerCase().replace(/[^a-z0-9._-]+/g,'-').replace(/^-+|-+$/g,'');
          h.setAttribute('id', id);
        }
        var li = document.createElement('li');
        li.className = 'list_item';
        var a = document.createElement('a');
        a.className = 'link';
        a.href = '#'+id;
        a.textContent = h.textContent;
        if(h.tagName === 'H3') li.style.marginLeft = '12px';
        li.appendChild(a);
        list.appendChild(li);
      });
      toc.style.display = 'block';
    }

    // Wire spoilers
    content.querySelectorAll('.wiki-spoiler').forEach(function(spoiler){
      var toggle = spoiler.querySelector('.wiki-spoiler__toggle');
      var body = spoiler.querySelector('.wiki-spoiler__content');
      if(!toggle || !body) return;
      var showLabel = toggle.textContent;
      var hideLabel = toggle.getAttribute('data-hide') || showLabel;
      toggle.addEventListener('click', function(){
        var expanded = body.style.display !== 'none';
        if(expanded){
          body.style.display = 'none';
          toggle.textContent = showLabel;
        } else {
          body.style.display = '';
          toggle.textContent = hideLabel;
        }
      });
    });
  })();
</script>
{* modal script removed *}
<style n:syntax="off">
  .wiki_content table.wiki-table{width:100%;border-collapse:collapse;margin:8px 0}
  .wiki_content table.wiki-table td,.wiki_content table.wiki-table th{border:1px solid #e1e5eb;padding:6px 8px;vertical-align:top}
  .wiki_content table.wiki-table tr:nth-child(even){background:#fafbfc}
  .wiki_content blockquote{border-left:3px solid #dfe7f1;background:#f7f9fc;margin:8px 0;padding:8px 10px;color:#333}
  .wiki_content .wiki-spoiler{display:inline-block;background:#f0f2f5;border-radius:4px;padding:4px 6px;margin:4px 0;color:#334155}
  .wiki_content .wiki-spoiler__toggle{background:none;border:none;padding:0;color:#2a5885;font-weight:600;cursor:pointer}
  .wiki_content .wiki-spoiler__toggle:hover{text-decoration:underline}
  .wiki_content .wiki-spoiler__content{display:none;margin-top:4px}
  .wiki_content pre.wiki-code{background:#1e293b;color:#f8fafc;padding:10px 12px;border-radius:6px;overflow:auto;font-family:"Consolas","Courier New",monospace;font-size:13px;line-height:1.45;margin:10px 0}
  .wiki_content pre.wiki-code code{background:none;padding:0;color:inherit}
  .wiki_content h2:hover a.anchor,.wiki_content h3:hover a.anchor{opacity:1}
  .wiki_content a.anchor{margin-left:6px;font-size:12px;opacity:.2;text-decoration:none}
  .wiki_content h2{font-size:18px;line-height:1.3;margin:12px 0 6px;font-weight:700}
  .wiki_content h3{font-size:16px;line-height:1.3;margin:10px 0 6px;font-weight:700}
  .wiki_content h4{font-size:14px;line-height:1.3;margin:8px 0 4px;font-weight:600}
  .wiki_content h5,.wiki_content h6{font-size:13px;line-height:1.3;margin:6px 0 4px;color:#55677d;font-weight:600}
</style>
